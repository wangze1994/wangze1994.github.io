<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Node.js," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="èƒŒæ™¯è¿‘æœŸå…¬å¸å†³å®šé‡æ„é¡¹ç›®ä»£ç ,(å› ä¸ºå®åœ¨ä¸èƒ½ç»´æŠ¤äº†,å„ç§æ·±åº¦å›è°ƒğŸ’)ã€‚äºæ˜¯ç»ˆäºå†³å®šä½¿ç”¨es6è¿›è¡Œé¡¹ç›®é‡æ„,åœ¨é‡æ„å‰å…ˆå¯¹ç°æœ‰çš„è§£å†³å›è°ƒåµŒå¥—çš„å‡ ç§æ–¹å¼è¿›è¡Œäº†å®è·µ,åœ¨æ­¤è®°å½•ä¸‹æ¥ã€‚
åœ¨æ­¤ä¹‹å‰é¡¹ç›®ä¸­ä¸»è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“asyncå¤„ç†å¼‚æ­¥ã€‚é€šè¿‡asyncæ¨¡å—,ç¡®å®å¯ä»¥å¾ˆå¥½çš„æ§åˆ¶å¼‚æ­¥æµç¨‹,ä»£ç å˜å¾—æ¸…æ™°å¾ˆå¤š,ä¹Ÿç®—æ˜¯è§£å†³äº†å±‚å±‚å¼‚æ­¥å›è°ƒçš„é—®é¢˜,ä½†æ˜¯å†™æ³•ä¸Šä»ç„¶æ˜¯å›è°ƒå‡½æ•°ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼åœ¨æ­¤å°±ä¸å¤šå™è¿°äº†ã€‚

æ‹¥æŠ±ES6:">
<meta property="og:type" content="article">
<meta property="og:title" content="è§£å†³jså¼‚æ­¥æµç¨‹æ–¹å¼æ¯”è¾ƒ">
<meta property="og:url" content="https://wangze1994.github.io/2016/12/18/è§£å†³jså¼‚æ­¥æµç¨‹æ–¹å¼æ¯”è¾ƒ/index.html">
<meta property="og:site_name" content="ğŸŒ">
<meta property="og:description" content="èƒŒæ™¯è¿‘æœŸå…¬å¸å†³å®šé‡æ„é¡¹ç›®ä»£ç ,(å› ä¸ºå®åœ¨ä¸èƒ½ç»´æŠ¤äº†,å„ç§æ·±åº¦å›è°ƒğŸ’)ã€‚äºæ˜¯ç»ˆäºå†³å®šä½¿ç”¨es6è¿›è¡Œé¡¹ç›®é‡æ„,åœ¨é‡æ„å‰å…ˆå¯¹ç°æœ‰çš„è§£å†³å›è°ƒåµŒå¥—çš„å‡ ç§æ–¹å¼è¿›è¡Œäº†å®è·µ,åœ¨æ­¤è®°å½•ä¸‹æ¥ã€‚
åœ¨æ­¤ä¹‹å‰é¡¹ç›®ä¸­ä¸»è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“asyncå¤„ç†å¼‚æ­¥ã€‚é€šè¿‡asyncæ¨¡å—,ç¡®å®å¯ä»¥å¾ˆå¥½çš„æ§åˆ¶å¼‚æ­¥æµç¨‹,ä»£ç å˜å¾—æ¸…æ™°å¾ˆå¤š,ä¹Ÿç®—æ˜¯è§£å†³äº†å±‚å±‚å¼‚æ­¥å›è°ƒçš„é—®é¢˜,ä½†æ˜¯å†™æ³•ä¸Šä»ç„¶æ˜¯å›è°ƒå‡½æ•°ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼åœ¨æ­¤å°±ä¸å¤šå™è¿°äº†ã€‚

æ‹¥æŠ±ES6:">
<meta property="og:updated_time" content="2016-12-21T06:41:01.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="è§£å†³jså¼‚æ­¥æµç¨‹æ–¹å¼æ¯”è¾ƒ">
<meta name="twitter:description" content="èƒŒæ™¯è¿‘æœŸå…¬å¸å†³å®šé‡æ„é¡¹ç›®ä»£ç ,(å› ä¸ºå®åœ¨ä¸èƒ½ç»´æŠ¤äº†,å„ç§æ·±åº¦å›è°ƒğŸ’)ã€‚äºæ˜¯ç»ˆäºå†³å®šä½¿ç”¨es6è¿›è¡Œé¡¹ç›®é‡æ„,åœ¨é‡æ„å‰å…ˆå¯¹ç°æœ‰çš„è§£å†³å›è°ƒåµŒå¥—çš„å‡ ç§æ–¹å¼è¿›è¡Œäº†å®è·µ,åœ¨æ­¤è®°å½•ä¸‹æ¥ã€‚
åœ¨æ­¤ä¹‹å‰é¡¹ç›®ä¸­ä¸»è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“asyncå¤„ç†å¼‚æ­¥ã€‚é€šè¿‡asyncæ¨¡å—,ç¡®å®å¯ä»¥å¾ˆå¥½çš„æ§åˆ¶å¼‚æ­¥æµç¨‹,ä»£ç å˜å¾—æ¸…æ™°å¾ˆå¤š,ä¹Ÿç®—æ˜¯è§£å†³äº†å±‚å±‚å¼‚æ­¥å›è°ƒçš„é—®é¢˜,ä½†æ˜¯å†™æ³•ä¸Šä»ç„¶æ˜¯å›è°ƒå‡½æ•°ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼åœ¨æ­¤å°±ä¸å¤šå™è¿°äº†ã€‚

æ‹¥æŠ±ES6:">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'åšä¸»'
    }
  };
</script>




  <link rel="canonical" href="https://wangze1994.github.io/2016/12/18/è§£å†³jså¼‚æ­¥æµç¨‹æ–¹å¼æ¯”è¾ƒ/"/>

  <title> è§£å†³jså¼‚æ­¥æµç¨‹æ–¹å¼æ¯”è¾ƒ | ğŸŒ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?4426c9da592ad598f4ca17d232276ee8";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">ğŸŒ</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            å…³äº
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                è§£å†³jså¼‚æ­¥æµç¨‹æ–¹å¼æ¯”è¾ƒ
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">å‘è¡¨äº</span>
            <time itemprop="dateCreated" datetime="2016-12-18T11:31:29+08:00" content="2016-12-18">
              2016-12-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Node-js/" itemprop="url" rel="index">
                    <span itemprop="name">Node.js</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/18/è§£å†³jså¼‚æ­¥æµç¨‹æ–¹å¼æ¯”è¾ƒ/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/18/è§£å†³jså¼‚æ­¥æµç¨‹æ–¹å¼æ¯”è¾ƒ/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
              &nbsp; | &nbsp;
              <span class="page-pv">æœ¬æ–‡æ€»é˜…è¯»é‡
              <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>æ¬¡
              </span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>è¿‘æœŸå…¬å¸å†³å®šé‡æ„é¡¹ç›®ä»£ç ,(å› ä¸ºå®åœ¨ä¸èƒ½ç»´æŠ¤äº†,å„ç§æ·±åº¦å›è°ƒğŸ’)ã€‚äºæ˜¯ç»ˆäºå†³å®šä½¿ç”¨es6è¿›è¡Œé¡¹ç›®é‡æ„,åœ¨é‡æ„å‰å…ˆå¯¹ç°æœ‰çš„è§£å†³å›è°ƒåµŒå¥—çš„å‡ ç§æ–¹å¼è¿›è¡Œäº†å®è·µ,åœ¨æ­¤è®°å½•ä¸‹æ¥ã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰é¡¹ç›®ä¸­ä¸»è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“asyncå¤„ç†å¼‚æ­¥ã€‚é€šè¿‡asyncæ¨¡å—,ç¡®å®å¯ä»¥å¾ˆå¥½çš„æ§åˆ¶å¼‚æ­¥æµç¨‹,ä»£ç å˜å¾—æ¸…æ™°å¾ˆå¤š,ä¹Ÿç®—æ˜¯è§£å†³äº†å±‚å±‚å¼‚æ­¥å›è°ƒçš„é—®é¢˜,ä½†æ˜¯å†™æ³•ä¸Šä»ç„¶æ˜¯å›è°ƒå‡½æ•°ã€‚æ‰€ä»¥è¿™ç§æ–¹å¼åœ¨æ­¤å°±ä¸å¤šå™è¿°äº†ã€‚</p>
<blockquote>
<p>æ‹¥æŠ±ES6:</p>
</blockquote>
<p>ES6ä¸­å¼•å…¥äº†åŸç”Ÿçš„Promiseç»™jsä¸­çš„å›è°ƒé—®é¢˜æä¾›äº†è§£å†³æ–¹æ¡ˆ(ä½†æ˜¯è¿˜æ˜¯ä¹ æƒ¯ä½¿ç”¨Bluebird)ã€‚ES6è¯­æ³•ä¸­çš„Generatorå‡½æ•°æ­é…TJå¤§ç¥çš„coæ¨¡å—ä¹Ÿæ˜¯ç»™æˆ‘ä»¬å¸¦æ¥äº†ç¼–å†™åŒæ­¥ä»£ç çš„ä½“éªŒ,åŒæ—¶å¯ä»¥ä½¿ç”¨try/catchã€‚ES7ä¸­æä¾›äº†asyncå’Œawait,<br>å¯ä»¥è¯´æ˜¯Generatorå’Œcoçš„å‡çº§ç‰ˆ,æ¯”èµ·*å’Œyieldï¼Œè¯­ä¹‰æ›´æ¸…æ¥šã€‚è€Œä¸”ä¸ç”¨å¼•ç”¨ç¬¬ä¸‰æ–¹çš„coæ¨¡å—ã€‚å¹¶ä¸”åœ¨Node.js7ä¸­,å·²ç»æ”¯æŒasyncå’Œawaitã€‚</p>
<a id="more"></a>
<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">let userPromise   = user.findOne().exec();</div><div class="line">let doctorPromise = doctor.find().exec();</div><div class="line"></div><div class="line">userPromise.then(user =&gt; &#123;</div><div class="line">    console.log(user)</div><div class="line">    return doctorPromise;</div><div class="line">&#125;).then(doctors =&gt; &#123;</div><div class="line">    console.log(doctors.length);</div><div class="line">&#125;).catch(err =&gt; &#123;</div><div class="line">    console.log(err);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Promiseçš„then()æ–¹æ³•å¯ä»¥è¿”å›å¦ä¸€ä¸ªPromiseï¼Œä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªåŒæ­¥çš„å€¼ï¼Œå¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ªåŒæ­¥å€¼ï¼Œå°†ä¼šè¢«åŒ…è£…æˆä¸€ä¸ªPromiseã€‚<br>ä¸Šé¢ä¸€ä¸ªä¾‹å­ï¼Œæ˜¯ä½¿ç”¨çš„Promiseé“¾ã€‚<br>mongooseçš„exec()ä¼šè¿”å›ä¸€ä¸ªPromise,é€šè¿‡å®šä¹‰,ç„¶ååœ¨then()æ–¹æ³•é‡Œè·å¾—æŸ¥è¯¢åˆ°çš„ç”¨æˆ·æ•°æ®,é€å±‚è°ƒç”¨then()æ–¹æ³•ï¼Œå½¢æˆä¸€ä¸ªPromiseé“¾ã€‚<br>åœ¨è¿™ä¸ªPromiseé“¾ä¸Šï¼Œå¦‚æœä»»ä½•ä¸€ä¸ªç¯èŠ‚å‡ºç°å¼‚å¸¸ï¼Œéƒ½ä¼šè¢«æœ€åçš„catch()æ•æ‰åˆ°ã€‚<br>å¯ä»¥è¯´ï¼Œè¿™ä¸ªä½¿ç”¨Promiseé“¾å†™çš„ä»£ç ï¼Œæ¯”å±‚å±‚è°ƒç”¨å›è°ƒå‡½æ•°æ›´ä¼˜é›…ï¼Œæµç¨‹ä¹Ÿæ›´æ˜ç¡®ã€‚<br>ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œåœ¨äºï¼Œæ¯ä¸€ä¸ªthen()æ–¹æ³•è·å–çš„å¯¹è±¡ï¼Œéƒ½æ˜¯ä¸Šä¸€ä¸ªthen()æ–¹æ³•è¿”å›çš„æ•°æ®ã€‚è€Œä¸èƒ½è·¨å±‚è®¿é—®ã€‚<br>ä»€ä¹ˆæ„æ€?å°±æ˜¯è¯´æˆ‘ä»¬åœ¨ç¬¬äºŒä¸ªthen()ä¸­åªèƒ½è·å–åˆ°æŸ¥è¯¢çš„ç»“æœdoctors,è€Œä¸èƒ½ä½¿ç”¨ä¸Šé¢çš„useræ•°æ®ã€‚</p>
<p>æœ‰ä¸€ç§æ–¹å¼ï¼Œ æ˜¯åœ¨æ¯ä¸ªthen()æ–¹æ³•é‡Œéƒ½å°†æ•°æ®ä¼ è¿‡æ¥ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">let userPromise   = user.findOne().exec();</div><div class="line">let doctorPromise = doctor.find().exec();</div><div class="line"></div><div class="line">userPromise.then(user =&gt; &#123;</div><div class="line">    return &#123;user: user , db: doctorPromise&#125;;</div><div class="line">&#125;).then(results =&gt; &#123;</div><div class="line">    return results.db.then(doctor =&gt; &#123;</div><div class="line">        return &#123;user: results.user , doctor: doctor&#125;</div><div class="line">    &#125;)</div><div class="line">&#125;).then(result =&gt; &#123;</div><div class="line">    console.log(result.user.name , result.doctor.length)</div><div class="line">&#125;).catch(err =&gt; &#123;</div><div class="line">    console.log(err);</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬åœ¨æ¯ä¸ªthen()æ–¹æ³•çš„è¿”å›ä¸­ï¼Œéƒ½å°†æ¯æ¬¡çš„å…¶ä»–ç»“æœç»„æˆä¸€ä¸ªå¯¹è±¡è¿”å›ã€‚<br>è¿™æ ·å¦‚æœæ¯æ¬¡çš„ç»“æœéƒ½æ˜¯ä¸€ä¸ªåŒæ­¥çš„å€¼è¿˜å¥½è¯´ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸€ä¸ªPromiseå€¼ï¼Œæ¯ä¸€ä¸ªPromiseéƒ½éœ€è¦å¤šåšä¸€å±‚è§£æã€‚</p>
<h3 id="co-amp-amp-Generator"><a href="#co-amp-amp-Generator" class="headerlink" title="co &amp;&amp; Generator"></a>co &amp;&amp; Generator</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">const hello = ()=&gt; &#123;</div><div class="line">    return new Promise((resolve , reject) =&gt; &#123;</div><div class="line">        setTimeout(()=&gt; &#123;</div><div class="line">            resolve(&apos;hello world&apos;);</div><div class="line">        &#125; , 500);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">const list = ()=&gt; &#123;</div><div class="line">    return new Promise((resolve , reject)=&gt; &#123;</div><div class="line">        setTimeout(()=&gt; &#123;</div><div class="line">            resolve([1 , 2 , 3]);</div><div class="line">        &#125; , 500);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">co(function *() &#123;</div><div class="line">    let helloRes = yield hello();</div><div class="line">    let listRes  = yield list();</div><div class="line">    console.log(helloRes , listRes)</div><div class="line">&#125;).catch(err =&gt; &#123;</div><div class="line">    console.log(err)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>coä½œä¸ºä¸€ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªGeneratorå‡½æ•°ä½œä¸ºå‚æ•°,åœ¨ç”Ÿæˆå™¨ä¸­ä½¿ç”¨yieldå…³é”®å­—æ¥åŒæ­¥çš„è·å–åŒæ­¥æˆ–å¼‚æ­¥æ“ä½œçš„å€¼ã€‚<br>åœ¨ä¸Šé¢çš„ä»£ç å½¢å¼ä¸­,æˆ‘ä»¬å®Œæˆäº†å½¢ä¼¼åŒæ­¥çš„å¼‚æ­¥æµç¨‹,æ¯”Promiseè¦ä¼˜é›…è®¸å¤šã€‚</p>
<h3 id="async-amp-amp-await"><a href="#async-amp-amp-await" class="headerlink" title="async &amp;&amp; await"></a>async &amp;&amp; await</h3><p>ä½¿ç”¨asyncå’Œawaitæ¥æ”¹å†™ä»¥ä¸Šç¤ºä¾‹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">(async function () &#123;</div><div class="line">    let helloRes = await hello();</div><div class="line">    let listRes  = await list();</div><div class="line">    console.log(helloRes , listRes)</div><div class="line">&#125;)().catch(err =&gt; &#123;</div><div class="line">    console.log(err);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>åŸæœ¬ä»¥ä¸ºNode.js v7å·²ç»å¯ä»¥æ”¯æŒasync/await,æ²¡æƒ³åˆ°â€¦ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">(async function () &#123;</div><div class="line">       ^^^^^^^^</div><div class="line">SyntaxError: Unexpected token function</div><div class="line">    at Object.exports.runInThisContext (vm.js:78:16)</div><div class="line">    at Module._compile (module.js:543:28)</div><div class="line">    at Object.Module._extensions..js (module.js:580:10)</div><div class="line">    at Module.load (module.js:488:32)</div><div class="line">    at tryModuleLoad (module.js:447:12)</div><div class="line">    at Function.Module._load (module.js:439:3)</div><div class="line">    at Module.runMain (module.js:605:10)</div><div class="line">    at run (bootstrap_node.js:420:7)</div><div class="line">    at startup (bootstrap_node.js:139:9)</div><div class="line">    at bootstrap_node.js:535:3</div></pre></td></tr></table></figure>
<p>å°´å°¬,è¯´æ˜node7è¿˜æ²¡æœ‰åœ¨è¯­æ³•ä¸Šç›´æ¥æ”¯æŒasync awaitï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨è¿˜æ˜¯è¦åŠ ä¸Šå‚æ•°</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">node --harmony-async-await bin/sub_test.js</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯¹æ¯”ä»£ç å¯ä»¥çœ‹å‡ºï¼Œasync/awaitå’Œcoä¸¤ç§æ–¹å¼ä»£ç æä¸ºç›¸ä¼¼ã€‚<br>coæ¢æˆäº†asyncï¼Œyieldæ¢æˆäº†awaitã€‚åŒæ—¶ç”Ÿæˆå™¨å‡½æ•°å˜æˆäº†æ™®é€šå‡½æ•°ã€‚<br>è¿™ç§æ–¹å¼åœ¨è¯­ä¹‰ä¸Šæ›´åŠ æ¸…æ™°æ˜äº†ï¼Œasyncè¡¨æ˜è¿™ä¸ªå‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼ŒåŒæ—¶awaitè¡¨ç¤ºè¦â€œç­‰å¾…â€å¼‚æ­¥æ“ä½œè¿”å›å€¼ã€‚<br>asyncå‡½æ•°è¿”å›ä¸€ä¸ªPromiseï¼Œä¸Šé¢çš„ä»£ç å…¶å®æ˜¯è¿™æ ·:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">let getResult = async function () &#123;</div><div class="line">    let helloRes = await hello();</div><div class="line">    let listRes  = await list();</div><div class="line">    return &#123;helloRes , listRes&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">getResult().then(result =&gt; &#123;</div><div class="line">    console.log(result.helloRes , result.listRes);</div><div class="line">&#125;).catch(err =&gt; &#123;</div><div class="line">    console.log(err);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å®šä¹‰getResultä¸ºä¸€ä¸ªasyncå‡½æ•°ï¼Œæœ€åè¿”å›å¾—åˆ°çš„æœ€ç»ˆä¼šè¢«åŒ…è£…æˆä¸€ä¸ªPromiseè¿”å›ï¼Œå¦‚ä¸Šï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨getResult().then()æ–¹æ³•å¯è·å–asyncå‡½æ•°è¿”å›å€¼ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä»ä¸Šé¢çš„å‡ ä¸ªç®€å•å®è·µ,èƒ½å¤Ÿçœ‹å‡ºæ¥async/awaitçš„å¼ºå¤§ï¼Œå¯ä»¥éå¸¸ä¼˜é›…åœ°å¤„ç†å¼‚æ­¥å‡½æ•°ï¼Œå¯ä»¥å‘Šåˆ«å¤§é‡å›è°ƒåµŒå¥—å’Œthenæ–¹æ³•ã€‚ä½†æ˜¯node.jså½“å‰å¯¹async/awaitçš„æ”¯æŒè¿˜æ˜¯è®©æˆ‘ä»¬æœ‰æ‰€é¡¾è™‘,è™½ç„¶å’Œè°æ¨¡å¼ä¸‹å¯ä»¥ä½¿ç”¨ã€‚è¿˜æ˜¯éœ€è¦å»ç”¨babelå»è½¬è¯‘ã€‚</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>å¦‚æœä½ å–œæ¬¢ï¼</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>èµ</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="http://photo-1253141962.costj.myqcloud.com/wechat-reward.jpg" alt="é£å’Œæ—¥ä¸½ç‹æ³½æ³½æ³½ã€‚ WeChat Pay"/>
          <p>å¾®ä¿¡æ‰“èµ</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="http://photo-1253141962.costj.myqcloud.com/alipay-reward.jpg" alt="é£å’Œæ—¥ä¸½ç‹æ³½æ³½æ³½ã€‚ Alipay"/>
          <p>æ”¯ä»˜å®æ‰“èµ</p>
        </div>
      
    </div>
  </div>


      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Node-js/" rel="tag">#Node.js</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/17/CentOSæœåŠ¡å™¨Node-jsç¯å¢ƒæ­å»º/" rel="next" title="CentOSæœåŠ¡å™¨Node.jsç¯å¢ƒæ­å»º">
                <i class="fa fa-chevron-left"></i> CentOSæœåŠ¡å™¨Node.jsç¯å¢ƒæ­å»º
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/12/18/javaScriptä¹¦å†™è§„èŒƒ/" rel="prev" title="javaScriptä¹¦å†™è§„èŒƒ">
                javaScriptä¹¦å†™è§„èŒƒ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/12/18/è§£å†³jså¼‚æ­¥æµç¨‹æ–¹å¼æ¯”è¾ƒ/"
           data-title="è§£å†³jså¼‚æ­¥æµç¨‹æ–¹å¼æ¯”è¾ƒ" data-url="https://wangze1994.github.io/2016/12/18/è§£å†³jså¼‚æ­¥æµç¨‹æ–¹å¼æ¯”è¾ƒ/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://photo-1253141962.costj.myqcloud.com/avatar.JPG"
               alt="é£å’Œæ—¥ä¸½ç‹æ³½æ³½æ³½ã€‚" />
          <p class="site-author-name" itemprop="name">é£å’Œæ—¥ä¸½ç‹æ³½æ³½æ³½ã€‚</p>
          <p class="site-description motion-element" itemprop="description">ä¸æŠ½çƒŸ,ä¸å–é…’,ä¸å’Œå¥³å­©å„¿å¹¶æ’èµ°ğŸ˜</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">9</span>
              <span class="site-state-item-name">æ—¥å¿—</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/wangze1994" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/3959668985/profile?rightmod=1&wvr=6&mod=personinfo" target="_blank" title="å¾®åš">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  å¾®åš
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#èƒŒæ™¯"><span class="nav-number">1.</span> <span class="nav-text">èƒŒæ™¯</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Promise"><span class="nav-number">2.</span> <span class="nav-text">Promise</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#co-amp-amp-Generator"><span class="nav-number">3.</span> <span class="nav-text">co && Generator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#async-amp-amp-await"><span class="nav-number">4.</span> <span class="nav-text">async && await</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">5.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">é£å’Œæ—¥ä¸½ç‹æ³½æ³½æ³½ã€‚</span>
</div>

<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">æœ¬ç«™è®¿å®¢æ•°<span class="busuanzi-value" id="busuanzi_value_site_uv"></span>äººæ¬¡</span>
  

  
    <span class="site-pv">æœ¬ç«™æ€»è®¿é—®é‡<span class="busuanzi-value" id="busuanzi_value_site_pv"></span>æ¬¡</span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"wz-hexo-blog"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  

</body>
</html>
